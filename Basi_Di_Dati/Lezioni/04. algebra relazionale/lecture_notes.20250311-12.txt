algebra relazionale: linguaggio di interrogazione procedurale che definisce le operazioni necessarie per estrarre dati da una o piÃ¹ relazioni di un database

movie(id, title, year, length, plot)
rating(check_date, source, movie, score, scale, votes)

esempio di interrogazione: trovare il titolo delle pellicole prodotte nel 2010

l'algebra prevede
- operatori unari: proiezione (ğ›‘), selezione (ğ›”), ridenominazione (ğ›’)
- operatori binari insiemistici: unione, intersezione, sottrazione
- operatori binari join: theta join, equijoin, naturaljoin


-- unione: date due relazioni R1 e R2, l'operatore di unione restituisce gli elementi appartenenti a R1 o R2
R1 âˆª R2 = { r1 âˆˆ R1 âˆ¨ r2 âˆˆ R2}

-- intersezione: date due relazioni R1 e R2, l'operatore di intersezione restituisce gli elementi appartenenti a R1 e R2
R1 âˆ© R2 = { r1 âˆˆ R1 âˆ§ r2 âˆˆ R2}

-- differenza: date due relazioni R1 e R2, l'operatore di differenza restituisce gli elementi appartenenti a R1 e non appartenenti a R2
R1 - R2 = { r1 âˆˆ R1 âˆ§ r2 âˆ‰ R2}

-- condizioni per applicare unione/intersezione/sottrazione a R1(X) e R2 (Y)
--- il grado di grado(R1) = grado(R2)
--- dom(x_i) = dom(y_i) per ogni x_i âˆˆ R1, y_i âˆˆ R2


-- esempio di sottrazione:
-- trovare le pellicole del 2010 che non sono thriller 
--- movie(id, title, year)
--- genre(movie, genre)

-- relazione R1: una relazione con grado 1 che contiene l'attributo movie.id e i record dei movie prodotti nell'anno 2010

-- relazione R2: una relazione con grado 1 che contiene l'attributo genre.movie delle pellicole thriller

--- R1 - R2 fornisce il risultato

-- esempio di unione: trovare le pellicole che sono di genere thriller o crime

-- esempio di intersezione: trovare le pellicole che sono di genre comedy e romance


-- operatore di selezione (ğ›”): ğ›”(p) R
esegue una selezione delle ennuple della relazione R restituendo una relazione risultato che contiene le ennuple di R che soddisfano il predicato p
--- puÃ² utilizzare operatori booleani: AND, OR, NOT

-- trovare le pellicole del 2010
ğ›”(year= '2010')  movie

-- trovare le pellicole prodotte fra il 2010 e il 2020
ğ›”(year => '2010' âˆ§ year <= '2020')  movie


-- operatore di proiezione (ğ›‘): ğ›‘(x) R
esegue una selezione degli attributi di R restituendo una relazione risultato che contiene solo gli attributi x di R

-- trovare le pellicole del 2010 che non sono thriller 
R1 = ğ›‘(id) [ğ›”(year= '2010')  movie]
R2 = ğ›‘(movie) [ğ›”(genre='thriller') genre]
risultato = R1 - R2
--- soluzione con un'unica espressione:
[ğ›‘(id) [ğ›”(year= '2010')  movie]] - [ğ›‘(movie) [ğ›”(genre='thriller') genre]]


-- trovare le pellicole che sono di genre comedy e romance
mv_comedy = ğ›‘(movie) [ğ›”(genre='comedy') genre]
mv_romance = ğ›‘(movie) [ğ›”(genre='romance') genre]
risultato = mv_comedy âˆ© mv_romance

-- soluzione alternativa? no: le seguenti sono soluzioni errate!
S1 = ğ›‘(movie) [ğ›”(genre='comedy' âˆ§ genre='romance') genre]
S2 = ğ›‘(movie) [ğ›”(genre='comedy' âˆ¨ genre='romance') genre]


-- trovare le persone che hanno interpretato come attore il personaggio 'dexter':
person(id, given_name, birth_date, death_date)
crew(movie, person, role, character)
crew.person -> FK -> person.id
ğ›‘(person) [ğ›”(character='dexter' âˆ§ role='actor') crew]

-- soluzione ottimizzata
ğ›‘(person) [ğ›”(character='dexter') [ğ›”(role='actor') crew] ]

-- operazioni di join
-- trovare il nome delle persone che hanno interpretato come attore il personaggio 'dexter'

-- operazione preliminare al join: prodotto cartesiano
Date le relazioni R1(X) e R2(Y) il prodotto cartesiano R1 x R2 restituisce una relazione risultato definita su XY popolata con ogni possibile combinazione delle ennuple di R1 e R2
R1(A, B)
R2(C, D)

R1 
A  |  B
a1    b1
a2    b2

R2
C  |  D
c1    d1
c2    d2
c3    d3

R1 x R2 = (A, B, C, D)

A  |  B  |  C  |  D
a1    b1    c1    d1
a1    b1    c2    d2
a1    b1    c3    d3
a2    b2    c1    d1
a2    b2    c2    d2
a2    b2    c3    d3  


movie(id, title)
genre(movie, genre)


movie
m1    batman
m2    spiderman


genre
m1    action
m1    comics
m2    dark

movie x genre = (id, title, movie, genre)

id   |   title   |   movie  |   genre
m1      batman        m1         action   ***  movie.id = genre.movie
m1      batman        m1         comics   ***  movie.id = genre.movie
m1      batman        m2         dark
m2      spiderman     m1         action
m2      spiderman     m1         comics
m2      spiderman     m2         dark     ***  movie.id = genre.movie

-- l'operazione di theta join â‹ˆ Ã¨ una selezione sul risultato del prodotto cartesiano in base a una condizione theta Î˜

Risultato join = R1 â‹ˆÎ˜ R2

R1(A, B)
R2(C, D)

join = R1 â‹ˆ(A>=C) R2

R1
1  | b1
2  | b2

R2
1  | d1
2  | d2
3  | d3

A   |   B    |   C   |   D
1       b1       1       d1  ** inclusa nel join perchÃ¨ A>=C
1       b1       2       d2  
1       b1       3       d3
2       b2       1       d1  ** inclusa nel join perchÃ¨ A>=C
2       b2       2       d2  ** inclusa nel join perchÃ¨ A>=C
2       b2       3       d3


-- quando la condizione di theta join Ã¨ un'uguaglianza si parla di equijoin

trovare il titolo delle pellicole con i rispettivi generi
risultato = ğ›‘(id, title, genre) [movie â‹ˆ(movie.id = genre.movie) genre]

-- restituire il nome delle persone nate dopo il 2000 che recitano in film thriller
movie(id, title)
genre(movie, genre)
crew(person, movie)
person(id, given_name, birth_date)

person_2000 = ğ›‘(id, given_name) [ğ›”(birth_date >= '2001-01-01') person]    
--schema: person_2000(id, given_name)

movie_thriller = ğ›‘(movie) [ğ›”(genre='thriller') genre]
--schema: movie_thriller(movie)

person_2000_crew = ğ›‘(id, given_name, movie) person_2000 * 
[ğ›’(id<-person) crew ]
--schema: person_2000_crew(id, given_name, movie)

risultato = ğ›‘(id, given_name) [person_2000_crew * movie_thriller]
--schema: risultato(id, given_name, movie)


-- join naturale: equijoin che considera l'uguaglianza di tutti gli attributi con il medesimo nome nelle due relazioni


R1(A, B)
R2(B, C)

R1 * R2(A, B, C)

-- operazione di ridenominazione (ğ›’): ğ›’(x->y) R
la ridenominazione cambia il nome di un attributo x della relazione R. denominandolo y

R1(A, B, C)
ğ›’(C->D) R1 --  R1(A, B, D)


-- ulteriori esercizi (si veda lo schema delle relazioni nel db IMDB)
-- trovare il titolo delle pellicole con valutazione (rating) maggiore di 8

-- trovare le pellicole thriller con valutazione sopra 8 su scala 10 (verificare entrambe le condizioni)

-- trovare il nome dei registi di film thriller

-- trovare i film le cui recensioni sono SEMPRE/TUTTE superiori a 8 

-- trovare le pellicole distribuite (released) sia in USA sia in FRA

-- trovare le pellicole che NON sono prodotte in GBR
